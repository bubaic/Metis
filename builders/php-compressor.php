<?php
class Compressor{static$RESERVED_VARS=array('$GLOBALS'=>1,'$_ENV'=>1,'$_SERVER'=>1,'$_SESSION'=>1,'$_REQUEST'=>1,'$_GET'=>1,'$_POST'=>1,'$_FILES'=>1,'$_COOKIE'=>1,'$HTTP_RAW_POST_DATA'=>1,'$php_errormsg'=>1,'$http_response_header '=>1,'$argc '=>1,'$argv '=>1,'$this'=>1);var$comment=null;var$keep_line_breaks=false;private$tokens=array();function load($B){$this->add_tokens($B);}function run(){$this->shrink_var_names();$this->remove_public_modifier();return$this->generate_result();}private function generate_result(){$C="<?php\n";if($this->comment){foreach($this->comment as$Q){$C.="# ".trim($Q)."\n";}}foreach($this->tokens as$D){$B=$D[1];if(!strlen($B))continue;if(preg_match("~^\\w\\w$~",$C[strlen($C)-1].$B[0]))$C.=" ";$C.=$B;}return$C;}private function remove_public_modifier(){for($A=0;$A<count($this->tokens)-1;$A++){if($this->tokens[$A][0]==T_PUBLIC)$this->tokens[$A]=$this->tokens[$A+1][1][0]=='$'?array(T_VAR,"var"):array(-1,"");}}private function shrink_var_names(){$G=array();$N=array();for($A=0;$A<count($this->tokens);$A++){list($J,$B)=$this->tokens[$A];if($J!=T_VARIABLE)continue;if(isset(self::$RESERVED_VARS[$B]))continue;if($A>0){$P=$this->tokens[$A-1][0];if($P==T_DOUBLE_COLON)continue;if($this->is_class_scope($A))continue;}$N[]=$A;if(!isset($G[$B]))$G[$B]=0;$G[$B]++;}arsort($G);$O=array();$A=0;foreach(array_keys($G)as$K){$O[$K]=$this->encode_id($A);$A++;}unset($G);foreach($N as$I){$K=$this->tokens[$I][1];$this->tokens[$I][1]='$'.$O[$K];}}private function is_class_scope($I){while($I--){$J=$this->tokens[$I][0];if($J==T_CLASS)return true;if($J==T_FUNCTION)return false;}return false;}private function add_tokens($B){$F=token_get_all(trim($B));if(!count($F))return;if(is_array($F[0])&&$F[0][0]==T_OPEN_TAG)array_shift($F);$M=count($F)-1;if(is_array($F[$M])&&$F[$M][0]==T_CLOSE_TAG)array_pop($F);$L=count($this->tokens)?"\n":"";foreach($F as$D){if(!is_array($D))$D=array(-1,$D);if($D[0]==T_COMMENT||$D[0]==T_DOC_COMMENT)continue;if($D[0]==T_WHITESPACE){$L.=$D[1];continue;}if($this->keep_line_breaks&&strpos($L,"\n")!==false){$this->tokens[]=array(-1,"\n");}$this->tokens[]=$D;$L="";}}private function encode_id($E){$C="";if($E>52){$C.=$this->encode_id_digit($E%53);$E=floor($E/53);}while($E>62){$C.=$this->encode_id_digit($E%63);$E=floor($E/63);}$C.=$this->encode_id_digit($E);return$C;}private function encode_id_digit($H){if($H<26)return chr(65+$H);if($H<52)return chr(71+$H);if($H==52)return"_";return chr($H-5);}}
?>