var metis;(function(b){(function(c){(function(e){function f(p){function g(t,u,v){if(t!==false){t(u,v)}}var i=b.file.currentIO[p]["pending"]["action"];var m=b.file.currentIO[p]["pending"]["files"];var o=b.file.currentIO[p]["pending"]["contentOrDestinationNodes"];var s=b.file.currentIO[p]["completed"];var q=b.file.currentIO[p]["callback"];var j=b.file.currentIO[p]["callback-data"];if(b.file.currentIO[p]["pending"]["nodeData"]!=="internal"){if(b.core.metisFlags.Headless==false){if((b.core.metisFlags["User Online"]==true)&&(b.core.metisFlags["Battery OK"]==true)){if(m.length>0){var k={};k.nodeData=b.file.currentIO[p]["pending"]["nodeData"];k.files=m;k.fileAction=i;if(o!==false){k.contentOrDestinationNodes=o}var r=new XMLHttpRequest;function l(){if(r.readyState==4){var w;if(r.status==200){w=b.file.Decode(r.responseText)}else{w={error:"HTTP ERROR CODE|' + xhrManager.status + '"}}for(var v in w){var u;if(m.length==1){v=m[0];u=w}else{u=w[v]}b.file.currentIO[p]["pending"]["files"].pop(v);b.file.currentIO[p]["completed"][v]=u;if(i=="r"){var t={nodeData:"internal",files:v,action:"w",contentOrDestinationNodes:u};b.file.Handler(t)}}g(q,b.file.currentIO[p]["completed"],j)}}r.onreadystatechange=l;r.open("POST",b.core.metisFlags.Callback,true);r.send(JSON.stringify(k))}}else{var h=b.file.currentIO[p]["pending"]["files"];if(b.file.currentIO[p]["pending"]["action"]!=="r"){h.push(Object.keys(s))}if(h.length>0){var n=b.file.RandomIOIdGenerator();b.file.currentIO[n]={pending:{nodeData:b.file.currentIO[p]["pending"]["nodeData"],files:h,action:i,contentOrDestinationNodes:o},completed:{}};b.queuer.AddItem(n)}g(q,b.file.currentIO[p]["completed"],j)}}else{g(q,b.file.currentIO[p]["completed"],j)}}else{g(q,b.file.currentIO[p]["completed"],j)}delete b.file.currentIO[p]}e.Handle=f})(c.cloud||(c.cloud={}));var d=c.cloud})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(b){(function(d){(function(e){function g(o){var l=b.file.currentIO[o];var h=l.pending["action"];var m=l.pending["files"];for(var i in m){var j=m[i];var n;var k;if((h=="r")||(h=="a")){n=localStorage.getItem(j);if(n!==null){n=b.file.Decode(n);if(h=="r"){k=true}}}if((h=="w")||(h=="a")){if(h=="a"){l.pending["contentOrDestinationNodes"]=b.core.Merge(n,l.pending["contentOrDestinationNodes"]);n=l.pending["contentOrDestinationNodes"]}else{n={status:"0.00"}}localStorage.setItem(j,JSON.stringify(l.pending["contentOrDestinationNodes"]));k=true}else{if(h=="d"){localStorage.removeItem(j);k=true;n={status:"0.00"}}else{if(h=="e"){if(localStorage.getItem(j)!==null){n={status:true}}else{n={status:false}}k=true}}}if(k==true){var p=false;if((h=="r")||(h=="e")){p=true}else{if((h=="w")||(h=="a")||(h=="d")){if(b.core.metisFlags.Headless==true){p=true}}}if(p==true){b.file.currentIO[o]["pending"]["files"].pop(j)}b.file.currentIO[o]["completed"][j]=n}}b.devices.cloud.Handle(o)}e.Handle=g;function f(){var h=localStorage.length;for(var j=0;j<h;j++){var k=localStorage.key(j);localStorage.removeItem(k)}}e.ClearAll=f})(d.web||(d.web={}));var c=d.web})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(a){(function(f){function e(){function h(i){if(i.ioQueue==false){a.file.Create({nodeData:"internal",fileName:"ioQueue",contentOrDestinationNodes:{}})}}a.file.Exists({nodeData:"internal",files:"ioQueue",callback:h});document.addEventListener("online",a.queuer.Process,false);document.addEventListener("offline",a.queuer.ToggleStatus,false)}f.Init=e;function c(){a.core.metisFlags["User Online"]=false}f.ToggleStatus=c;function d(){if(a.core.metisFlags["Battery OK"]==true){a.file.Read({nodeData:"internal",files:"ioQueue",callback:function(i){i=i.ioQueue;a.core.metisFlags["User Online"]=true;for(var l in i){var h=i[l]["nodeData"];var j=i[l]["action"];var k=i[l]["contentOrDestinationNodes"];if(a.core.metisFlags["User Online"]==true){a.file.Handler({nodeData:h,files:l,action:j,contentOrDestinationNodes:k});delete i[l]}else{break}}a.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:i})}})}}f.Process=d;function g(h){a.file.Read({nodeData:"internal",files:"ioQueue",callback:function(l,j){l=l.ioQueue;var i=a.file.currentIO[j.relatedIOId];var k=i.pending["nodeData"];var n=i.pending["action"];var p=i.pending["files"];for(var m in p){var o=p[m];if(l.hasOwnProperty(o)==true){delete l[o]}l[o]={};l[o]["nodeData"]=k;l[o]["action"]=n;if(n==("w"||"a")){l[o]["contentOrDestinationNodes"]=i.pending["contentOrDestinationNodes"]}else{delete l[o]["contentOrDestinationNodes"]}}a.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:l})},"callback-data":{relatedIOId:h}})}f.AddItem=g})(a.queuer||(a.queuer={}));var b=a.queuer})(metis||(metis={}));var metis;(function(b){(function(c){c.deviceIO;c.metisFlags;function e(f){this.metisFlags={};if(f.Headless==(undefined||false)){f.Headless=false;if(f.Callback==undefined){console.log("You have defined Headless as FALSE but have NOT provided a callback URL. Expect errors.")}}if(f.Device==undefined){f.Device="Cloud"}if(f["User Online"]==undefined){if(f.Device=="Cloud"){f["User Online"]=window.navigator.onLine;b.core.metisFlags["Battery OK"]=true}else{f["User Online"]=true;if(navigator.connection.type==Connection.NONE){f["User Online"]=false}document.addEventListener("batterystatus",function(g){b.core.metisFlags["Battery OK"]=true;if(g.isPlugged==false||g.level<15){b.core.metisFlags["Battery OK"]=false}},false)}}if(f.Device.toLowerCase().indexOf("chrome")==-1){this.deviceIO=b.devices.web}else{this.deviceIO=b.devices.chromeos}this.metisFlags=f;if(this.metisFlags.Headless==false){b.queuer.Init()}}c.Init=e;function d(g,f){for(var h in f){if(typeof f[h]=="object"){if(g[h]!==undefined){g[h]=this.Merge(g[h],f[h])}else{g[h]=f[h]}}else{g[h]=f[h]}}return g}c.Merge=d})(b.core||(b.core={}));var a=b.core})(metis||(metis={}));var metis;(function(a){(function(e){e.currentIO={};function h(){var n;var m=true;while(m==true){n=(Math.random()*(99999-10000)+10000).toFixed(0).toString();if(a.file.currentIO[n]==undefined){m=false;break}}return n}e.RandomIOIdGenerator=h;function j(s){var p=a.file.RandomIOIdGenerator();var q="";var m=s.nodeData;if(typeof m=="string"){q=m}else{if(typeof m=="object"){for(var t in m){var r=t;if(m[t]!==null){r=r+"#";var o=m[t];o.forEach(function(v,w,u){r=r+v;if(u.length!==(w+1)){r=r+","}else{r=r+"|"}});q=q+r}else{m=m+t+"|"}}m=m.slice(0,-1);q=m}else{if(typeof m=="number"){q=m.toString()}}}if(typeof s.files=="string"){s.files=[s.files]}if(s.contentOrDestinationNodes==undefined){s.contentOrDestinationNodes=false}if(s.callback==undefined){s.callback=false}if(s["callback-data"]==undefined){s["callback-data"]=false}var n={pending:{nodeData:q,files:s.files,action:s.action,contentOrDestinationNodes:s.contentOrDestinationNodes},completed:{},callback:s.callback};a.file.currentIO[p]=n;a.core.deviceIO.Handle(p)}e.Handler=j;function c(m){return JSON.parse(m)}e.Decode=c;function f(m){m.action="r";a.file.Handler(m)}e.Read=f;function g(m){m.action="w";a.file.Handler(m)}e.Create=g;function i(m){if(m.append!==true){delete m.append;m.action="w";a.file.Handler(m)}else{delete m.append;m.action="a";a.file.Handler(m)}}e.Update=i;function l(m){m.action="d";a.file.Handler(m)}e.Delete=l;function k(m){m.action="e";a.file.Handler(m)}e.Exists=k;function d(){a.core.deviceIO.ClearAll()}e.ClearAll=d})(a.file||(a.file={}));var b=a.file})(metis||(metis={}));var metis;(function(b){(function(c){(function(g){function f(l){var i=b.file.currentIO[l];var m=i.pending["action"];var h=i.pending["files"];var n=i.pending["contentOrDestinationNodes"];var k=function(){var p=arguments[0];var t=b.file.currentIO[p]["pending"]["action"];if((t=="r")||(t=="a")||(t=="e")){var s=arguments[1];for(o in s){var r;var v=s[o];if(typeof v=="Object"){if(t=="a"){var u=b.file.currentIO[p]["pending"]["contentOrDestinationNodes"];v=b.core.Merge(v,u);chrome.storage.local.set({fileName:v});v={status:true}}else{if(t=="e"){v={status:true}}}r=true}else{r=false}}}else{if(chrome.runtime.lastError==undefined){v={status:"0.00"};r=true}else{v={error:chrome.runtime.lastError};r=true;if(t=="w"){r=false}}}if(r==true){var q=false;if((t=="r")||(t=="e")){q=true}else{if((t=="w")||(t=="a")||(t=="d")){if(b.core.metisFlags.Headless==true){q=true}}}if(q==true){b.file.currentIO[p]["pending"]["files"].pop(o)}b.file.currentIO[p]["completed"][o]=v}b.devices.cloud.Handle(p)}.bind(this,l);if((m=="r")||(m=="a")||(m=="e")){chrome.storage.local.get(h,k)}else{if(m=="w"){var j={};for(var o in h){j[o]=n}chrome.storage.local.set(j,k)}else{if(m=="d"){chrome.storage.local.remove(h,k)}}}}g.Handle=f;function e(){chrome.storage.local.clear()}g.ClearAll=e})(c.chromeos||(c.chromeos={}));var d=c.chromeos})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(a){function b(c){return a.core.Init(c)}a.Init=b})(metis||(metis={}));