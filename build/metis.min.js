var metis;
(function(b){(function(c){(function(a){a.Handle=function(d){if("internal"===d.NodeData||b.Headless||0===d.PendingFiles.length)b.devices.cloud.fireCallback(d.Callback,d.CompletedFiles,d.CallbackData);else if(b.Online){var a={NodeData:d.NodeData,Action:d.Action,Files:d.Files};"object"==typeof d.ContentOrDestinationNodes&&(a.ContentOrDestinationNodes=d.ContentOrDestinationNodes);var c=new XMLHttpRequest;c.onreadystatechange=function(a){if(4==c.readyState){var d;d=200==c.status?b.file.Decode(c.responseText):{error:"HTTP ERROR CODE|"+
c.status};for(var f in d){var l=d[f];a.CompletedFiles[f]=l;"r"!=a.Action&&"a"!=a.Action||"undefined"!=typeof l.error||b.file.IO({NodeData:"internal",Files:f,Action:"w",ContentOrDestinationNodes:l})}b.devices.cloud.fireCallback(a.Callback,a.CompletedFiles,a.CallbackData)}}.bind(b,d);c.open("POST",b.Callback,!0);c.send(JSON.stringify(a))}else"r"!==d.Action&&(a=Object.keys(d.CompletedFiles),d.PendingFiles.push(a)),b.scheduler.AddItem({NodeData:d.NodeData,Action:d.Action,PendingFiles:d.PendingFiles,CompletedFiles:{},
ContentOrDestinationNodes:d.ContentOrDestinationNodes}),b.devices.cloud.fireCallback(d.Callback,d.CompletedFiles,d.CallbackData)};a.fireCallback=function(a,b,c){!1!==a&&a(b,c)}})(c.cloud||(c.cloud={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(c){(function(a){a.Handle=function(a){for(var f=a.Action,c=0,g=a.PendingFiles;c<g.length;c++){var e=g[c],k={success:!0};if("r"==f||"a"==f)k=localStorage.getItem(e),k=null!==k?b.file.Decode(k):{error:"file_doesnt_exist"};"w"==f||"a"==f?("a"==f&&"string"!==typeof k.error&&(a.ContentOrDestinationNodes=b.file.Merge(k,a.ContentOrDestinationNodes)),localStorage.setItem(e,JSON.stringify(a.ContentOrDestinationNodes))):"d"==f?localStorage.removeItem(e):"e"==f&&(k={exists:!0},null==localStorage.getItem(e)&&
(k={exists:!1}));var l=!1;"r"==f&&"undefined"==typeof k.error||"e"==f?l=!0:("w"==f||"a"==f||"d"==f)&&b.Headless&&(l=!0);l&&(a.PendingFiles=b.file.ArrayRemove(a.PendingFiles,e));a.CompletedFiles[e]=k}b.devices.cloud.Handle(a)};a.ClearAll=function(){localStorage.clear()}})(c.web||(c.web={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(c){c.Init=function(){b.file.IO({NodeData:"internal",Action:"e",Files:"scheduler",Callback:function(a){0==a.scheduler.status&&b.file.IO({NodeData:"internal",Action:"w",Files:"scheduler",ContentOrDestinationNodes:{}})}});document.addEventListener("online",b.scheduler.Process,!1);document.addEventListener("offline",b.scheduler.ToggleStatus,!1)};c.ToggleStatus=function(){b.Online=!1};c.Process=function(){b.file.IO({NodeData:"internal",Action:"r",Files:"scheduler",Callback:function(a){a=
a.scheduler;b.Online=!0;for(var d in a){var c=a[d].NodeData,h=a[d].Action,g=a[d].ContentOrDestinationNodes;if(b.Online)b.file.IO({NodeData:c,Action:h,Files:d,ContentOrDestinationNodes:g}),delete a[d];else break}b.file.IO({NodeData:"internal",Action:"u",Files:"scheduler",ContentOrDestinationNodes:a})}})};c.AddItem=function(a){b.file.IO({NodeData:"internal",Action:"r",Files:"scheduler",Callback:function(a,c){a=a.scheduler;for(var h=c.uniqueIOObject,g=0,e=h.Files;g<e.length;g++){var k=e[g];1==a.hasOwnProperty(k)&&
delete a[k];var l={NodeData:h.NodeData,Action:h.Action,Files:h.Files};"w"==h.Action&&(l.ContentOrDestinationNodes=h.ContentOrDestinationNodes);a[k]=l}b.file.IO({NodeData:"internal",Action:"u",Files:"scheduler",ContentOrDestinationNodes:a})},CallbackData:{uniqueIOObject:a}})}})(b.scheduler||(b.scheduler={}))})(metis||(metis={}));
(function(b){(function(c){c.IO=function(a){"number"===typeof a.NodeData&&(a.NodeData=a.NodeData.toString());"string"==typeof a.Files&&(a.Files=Array(a.Files));b.DeviceIO.Handle({NodeData:a.NodeData,Action:a.Action,ContentOrDestinationNodes:a.ContentOrDestinationNodes,PendingFiles:a.Files,CompletedFiles:{},Callback:a.Callback,CallbackData:a.CallbackData})};c.Decode=function(a){return JSON.parse(a)};c.ClearAll=function(){b.DeviceIO.ClearAll()};c.Read=function(a){a.Action="r";b.file.IO(a)};c.Write=function(a){a.Action=
"w";b.file.IO(a)};c.Update=function(a){a.Action="undefined"==typeof a.Append||0==a.Append?"w":"u";b.file.IO(a)};c.Delete=function(a){a.Action="d";b.file.IO(a)};c.ArrayRemove=function(a,b){var c=a.indexOf(b);return-1!==c?Array.prototype.concat(a.slice(0,c),a.slice(c+1)):a};c.Merge=function(a,b){for(var c in b)a[c]="object"==typeof b[c]?void 0!==a[c]?this.Merge(a[c],b[c]):b[c]:b[c];return a}})(b.file||(b.file={}))})(metis||(metis={}));
(function(b){(function(c){(function(a){a.Handle=function(a){var c=a.Action,h=a.PendingFiles,g=a.ContentOrDestinationNodes;a=function(a,c){var d=a.Action,f;for(f in c){var h=c[f],e,g=c[h];"Object"==typeof g?("r"==d||"a"==d||"e"==d?"a"==d?(g=b.file.Merge(g,a.ContentOrDestinationNodes),chrome.storage.local.set({fileName:g}),g={status:!0}):"e"==d&&(g={status:!0}):g={status:"0.00"},e=!0):e=!1;1==e&&(e=!1,"r"==d||"e"==d?e=!0:("w"==d||"a"==d||"d"==d)&&b.Headless&&(e=!0),1==e&&(a.PendingFiles=b.file.ArrayRemove(a.PendingFiles,
h)),a.CompletedFiles[h]=g)}b.devices.cloud.Handle(a)}.bind(this,a);if("r"==c||"a"==c||"e"==c)chrome.storage.local.get(h,a);else if("w"==c){var c={},e;for(e in h)c[h[e]]=g;chrome.storage.local.set(c,a)}else"d"==c&&chrome.storage.local.remove(h,a)};a.ClearAll=function(){chrome.storage.local.clear()}})(c.chromeos||(c.chromeos={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){b.Init=function(c){b.Device="Web";"string"==typeof c.Device&&(b.Device=c.Device);"Cordova"!==c.Device?b.Online=window.navigator.onLine:(b.Online=!0,navigator.connection.type==Connection.NONE&&(b.Online=!1));-1==c.Device.toLowerCase().indexOf("chrome")?b.DeviceIO=b.devices.web:b.DeviceIO=b.devices.chromeos;b.Headless=!0;"string"==typeof c.Callback&&(b.Headless=!1,b.scheduler.Init())}})(metis||(metis={}));
