var metis;
(function(b){(function(c){(function(a){a.Handle=function(a){var e=a.Action,c=a.pending,f=a.ContentOrDestinationNodes,d=a.completed,g=a.callback,l=a["callback-data"];if("internal"!==a.NodeData)if(0==b.core.metisFlags.Headless)if(1==b.core.metisFlags["User Online"]&&1==b.core.metisFlags["Battery OK"])if(0<c.length){d={};d.NodeData=a.NodeData;d.Files=c;d.Action=e;!1!==f&&(d.ContentOrDestinationNodes=f);var k=new XMLHttpRequest;k.onreadystatechange=function(a){if(4==k.readyState){var n=a["callback-data"],c;
c=200==k.status?b.file.Decode(k.responseText):{error:"HTTP ERROR CODE|"+k.status};for(var d in c){var h=c[d];a.completed[d]=h;"r"!=e&&"a"!=e||"undefined"!=typeof h.error||b.file.Handler({NodeData:"internal",Files:d,Action:"w",ContentOrDestinationNodes:h})}b.devices.cloud.fireCallback(g,a.completed,n)}}.bind(b,a);k.open("POST",b.core.metisFlags.Callback,!0);k.send(JSON.stringify(d))}else b.devices.cloud.fireCallback(g,d,l);else"r"!==a.Action&&c.push(Object.keys(d)),0<c.length&&b.queuer.AddItem({NodeData:a.NodeData,
pending:c,Action:e,ContentOrDestinationNodes:f,completed:{}}),b.devices.cloud.fireCallback(g,d,l);else b.devices.cloud.fireCallback(g,d,l);else b.devices.cloud.fireCallback(g,d,l)};a.fireCallback=function(a,b,c){!1!==a&&a(b,c)}})(c.cloud||(c.cloud={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(c){(function(a){a.Handle=function(a){for(var e=a.Action,c=a.pending,f=0;f<c.length;f++){var d=c[f],g={success:!0};if("r"==e||"a"==e)g=localStorage.getItem(d),null!==g&&(g=b.file.Decode(g));"w"==e||"a"==e?"a"==e&&null!==g?(g=b.core.Merge(g,a.ContentOrDestinationNodes),localStorage.setItem(d,JSON.stringify(g))):localStorage.setItem(d,JSON.stringify(a.ContentOrDestinationNodes)):"d"==e?localStorage.removeItem(d):"e"==e&&(g={exists:!0},null==localStorage.getItem(d)&&(g={exists:!1}));
var l=!1;"r"==e||"e"==e?l=!0:"w"!=e&&"a"!=e&&"d"!=e||1!=b.core.metisFlags.Headless||(l=!0);1==l&&a.pending.pop(d);a.completed[d]=g}b.devices.cloud.Handle(a)};a.ClearAll=function(){localStorage.clear()}})(c.web||(c.web={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(c){c.Init=function(){b.file.Exists({NodeData:"internal",Files:"ioQueue",callback:function(a){0==a.ioQueue.status&&b.file.Create({NodeData:"internal",Files:"ioQueue",ContentOrDestinationNodes:{}})}});document.addEventListener("online",b.queuer.Process,!1);document.addEventListener("offline",b.queuer.ToggleStatus,!1)};c.ToggleStatus=function(){b.core.metisFlags["User Online"]=!1};c.Process=function(){1==b.core.metisFlags["Battery OK"]&&b.file.Read({NodeData:"internal",Files:"ioQueue",
callback:function(a){a=a.ioQueue;b.core.metisFlags["User Online"]=!0;for(var c in a){var e=a[c].NodeData,h=a[c].Action,f=a[c].ContentOrDestinationNodes;if(1==b.core.metisFlags["User Online"])b.file.Handler({NodeData:e,Files:c,Action:h,ContentOrDestinationNodes:f}),delete a[c];else break}b.file.Update({NodeData:"internal",Files:"ioQueue",ContentOrDestinationNodes:a})}})};c.AddItem=function(a){b.file.Read({NodeData:"internal",Files:"ioQueue",callback:function(a,c){a=a.ioQueue;var h=c.uniqueIOObject,
f=h.pending.NodeData,d=h.pending.Action,g=h.pending.Files,l;for(l in g){var k=g[l];1==a.hasOwnProperty(k)&&delete a[k];a[k]={};a[k].NodeData=f;a[k].Action=d;"w"==d&&(a[k].ContentOrDestinationNodes=h.pending.ContentOrDestinationNodes)}b.file.Update({NodeData:"internal",Files:"ioQueue",ContentOrDestinationNodes:a})},"callback-data":{uniqueIOObject:a}})}})(b.queuer||(b.queuer={}))})(metis||(metis={}));
(function(b){(function(c){c.Init=function(a){b.core.metisFlags={};if("boolean"==typeof a.Headless&&!0!==a.Headless||"boolean"!==typeof a.Headless)a.Headless="undefined"==typeof a.Callback?!0:!1;"undefined"==typeof a.Device&&(a.Device="Cloud");"undefined"==typeof a["User Online"]&&("Cordova"!==a.Device?a["User Online"]=window.navigator.onLine:(a["User Online"]=!0,navigator.connection.type==Connection.NONE&&(a["User Online"]=!1)));a["Battery OK"]=!0;"Cordova"==a.Device&&document.addEventListener("batterystatus",
function(a){b.core.metisFlags["Battery OK"]=!0;if(0==a.isPlugged||15>a.level)b.core.metisFlags["Battery OK"]=!1},!1);b.core.deviceIO="Cloud"==a.Device?b.devices.web:b.devices.chromeos;b.core.metisFlags=a;0==b.core.metisFlags.Headless&&b.queuer.Init()};c.Merge=function(a,b){for(var c in b)a[c]="object"==typeof b[c]?void 0!==a[c]?this.Merge(a[c],b[c]):b[c]:b[c];return a}})(b.core||(b.core={}))})(metis||(metis={}));
(function(b){(function(c){c.Handler=function(a){var c=a.NodeData,e=c;"number"==typeof c&&(e=c.toString());"string"==typeof a.Files&&(a.Files=[a.Files]);b.core.deviceIO.Handle({NodeData:e,pending:a.Files,Action:a.Action,ContentOrDestinationNodes:a.ContentOrDestinationNodes,completed:{},callback:a.callback,"callback-data":a["callback-data"]})};c.Decode=function(a){return JSON.parse(a)};c.Read=function(a){a.Action="r";b.file.Handler(a)};c.Create=function(a){a.Action="w";b.file.Handler(a)};c.Update=function(a){!0!==
a.append?(delete a.append,a.Action="w"):(delete a.append,a.Action="a");b.file.Handler(a)};c.Delete=function(a){a.Action="d";b.file.Handler(a)};c.Exists=function(a){a.Action="e";b.file.Handler(a)};c.ClearAll=function(){b.core.deviceIO.ClearAll()}})(b.file||(b.file={}))})(metis||(metis={}));
(function(b){(function(c){(function(a){a.Handle=function(a){var c=a.Action,h=a.pending,f=a.ContentOrDestinationNodes;a=function(a,c){var d=a.Action,e;for(e in c){var h=c[e],f,m=c[h];"Object"==typeof m?("r"==d||"a"==d||"e"==d?"a"==d?(m=b.core.Merge(m,a.ContentOrDestinationNodes),chrome.storage.local.set({fileName:m}),m={status:!0}):"e"==d&&(m={status:!0}):m={status:"0.00"},f=!0):f=!1;1==f&&(f=!1,"r"==d||"e"==d?f=!0:"w"!=d&&"a"!=d&&"d"!=d||1!=b.core.metisFlags.Headless||(f=!0),1==f&&a.pending.pop(h),
a.completed[h]=m)}b.devices.cloud.Handle(a)}.bind(this,a);if("r"==c||"a"==c||"e"==c)chrome.storage.local.get(h,a);else if("w"==c){var c={},d;for(d in h)c[h[d]]=f;chrome.storage.local.set(c,a)}else"d"==c&&chrome.storage.local.remove(h,a)};a.ClearAll=function(){chrome.storage.local.clear()}})(c.chromeos||(c.chromeos={}))})(b.devices||(b.devices={}))})(metis||(metis={}));(function(b){b.Init=function(c){return b.core.Init(c)}})(metis||(metis={}));
