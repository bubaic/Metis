var metis;
(function(b){(function(c){(function(a){a.Handle=function(a){var d=a.action,c=a.pending,g=a.contentOrDestinationNodes,e=a.completed,h=a.callback,k=a["callback-data"];if("internal"!==a.nodeData)if(0==b.core.metisFlags.Headless)if(1==b.core.metisFlags["User Online"]&&1==b.core.metisFlags["Battery OK"])if(0<c.length){e={};e.nodeData=a.nodeData;e.files=c;e.action=d;!1!==g&&(e.contentOrDestinationNodes=g);var l=new XMLHttpRequest;l.onreadystatechange=function(a){if(4==l.readyState){var n=a["callback-data"],c;
c=200==l.status?b.file.Decode(l.responseText):{error:"HTTP ERROR CODE|"+l.status};for(var e in c){var f=c[e];a.completed[e]=f;"r"!=d&&"a"!=d||void 0!=f.error||b.file.Handler({nodeData:"internal",files:e,action:"w",contentOrDestinationNodes:f})}b.devices.cloud.fireCallback(h,a.completed,n)}}.bind(b,a);l.open("POST",b.core.metisFlags.Callback,!0);l.send(JSON.stringify(e))}else b.devices.cloud.fireCallback(h,e,k);else"r"!==a.action&&c.push(Object.keys(e)),0<c.length&&b.queuer.AddItem({nodeData:a.nodeData,
pending:c,action:d,contentOrDestinationNodes:g,completed:{}}),b.devices.cloud.fireCallback(h,e,k);else b.devices.cloud.fireCallback(h,e,k);else b.devices.cloud.fireCallback(h,e,k)};a.fireCallback=function(a,b,c){!1!==a&&a(b,c)}})(c.cloud||(c.cloud={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(c){(function(a){a.Handle=function(a){var d=a.action,c=a.pending,g;for(g in c){var e=c[g],h,k=!1;if("r"==d||"a"==d)h=localStorage.getItem(e),null!==h&&(h=b.file.Decode(h),"r"==d&&(k=!0));"w"==d||"a"==d?("a"==d&&null!==h?(h=b.core.Merge(h,a.contentOrDestinationNodes),localStorage.setItem(e,JSON.stringify(h))):(h={status:"0.00"},localStorage.setItem(e,JSON.stringify(a.contentOrDestinationNodes))),k=!0):"d"==d?(localStorage.removeItem(e),k=!0,h={status:"0.00"}):"e"==d&&(h=null!==
localStorage.getItem(e)?{status:!0}:{status:!1},k=!0);1==k&&(k=!1,"r"==d||"e"==d?k=!0:"w"!=d&&"a"!=d&&"d"!=d||1!=b.core.metisFlags.Headless||(k=!0),1==k&&a.pending.pop(e),a.completed[e]=h)}b.devices.cloud.Handle(a)};a.ClearAll=function(){for(var a=localStorage.length,b=0;b<a;b++){var c=localStorage.key(b);localStorage.removeItem(c)}}})(c.web||(c.web={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(c){c.Init=function(){b.file.Exists({nodeData:"internal",files:"ioQueue",callback:function(a){0==a.ioQueue.status&&b.file.Create({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:{}})}});document.addEventListener("online",b.queuer.Process,!1);document.addEventListener("offline",b.queuer.ToggleStatus,!1)};c.ToggleStatus=function(){b.core.metisFlags["User Online"]=!1};c.Process=function(){1==b.core.metisFlags["Battery OK"]&&b.file.Read({nodeData:"internal",files:"ioQueue",
callback:function(a){a=a.ioQueue;b.core.metisFlags["User Online"]=!0;for(var c in a){var d=a[c].nodeData,f=a[c].action,g=a[c].contentOrDestinationNodes;if(1==b.core.metisFlags["User Online"])b.file.Handler({nodeData:d,files:c,action:f,contentOrDestinationNodes:g}),delete a[c];else break}b.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:a})}})};c.AddItem=function(a){b.file.Read({nodeData:"internal",files:"ioQueue",callback:function(a,c){a=a.ioQueue;var f=c.uniqueIOObject,
g=f.pending.nodeData,e=f.pending.action,h=f.pending.files,k;for(k in h){var l=h[k];1==a.hasOwnProperty(l)&&delete a[l];a[l]={};a[l].nodeData=g;a[l].action=e;"w"==e&&(a[l].contentOrDestinationNodes=f.pending.contentOrDestinationNodes)}b.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:a})},"callback-data":{uniqueIOObject:a}})}})(b.queuer||(b.queuer={}))})(metis||(metis={}));
(function(b){(function(c){c.deviceIO;c.metisFlags;c.Init=function(a){b.core.metisFlags={};!0!==a.Headless&&(void 0==a.Callback?a.Headless=!0:-1==a.Callback.indexOf("/callback.php")&&("/"!==a.Callback.substr(a.Callback.length-1)&&(a.Callback+="/"),a.Callback+="callback.php"));void 0==a.Device&&(a.Device="Cloud");void 0==a["User Online"]&&("Cordova"!==a.Device?a["User Online"]=window.navigator.onLine:(a["User Online"]=!0,navigator.connection.type==Connection.NONE&&(a["User Online"]=!1)));a["Battery OK"]=
!0;"Cordova"==a.Device&&document.addEventListener("batterystatus",function(a){b.core.metisFlags["Battery OK"]=!0;if(0==a.isPlugged||15>a.level)b.core.metisFlags["Battery OK"]=!1},!1);-1==a.Device.toLowerCase().indexOf("chrome")?b.core.deviceIO=b.devices.web:b.core.deviceIO=b.devices.chromeos;b.core.metisFlags=a;0==b.core.metisFlags.Headless&&b.queuer.Init()};c.Merge=function(a,b){for(var c in b)a[c]="object"==typeof b[c]?void 0!==a[c]?this.Merge(a[c],b[c]):b[c]:b[c];return a}})(b.core||(b.core={}))})(metis||
(metis={}));
(function(b){(function(c){c.Handler=function(a){var c="",d=a.nodeData;if("string"==typeof d)c=d;else if("object"==typeof d){for(var f in d){var g=f;null!==d[f]?(g+="#",d[f].forEach(function(a,b,c){g+=a;g=c.length!==b+1?g+",":g+"|"}),c+=g):d=d+f+"|"}c=d=d.slice(0,-1)}else"number"==typeof d&&(c=d.toString());"string"==typeof a.files&&(a.files=[a.files]);void 0==a.contentOrDestinationNodes&&(a.contentOrDestinationNodes=!1);void 0==a.callback&&(a.callback=!1);void 0==a["callback-data"]&&(a["callback-data"]=!1);
b.core.deviceIO.Handle({nodeData:c,pending:a.files,action:a.action,contentOrDestinationNodes:a.contentOrDestinationNodes,completed:{},callback:a.callback,"callback-data":a["callback-data"]})};c.Decode=function(a){return JSON.parse(a)};c.Read=function(a){a.action="r";b.file.Handler(a)};c.Create=function(a){a.action="w";b.file.Handler(a)};c.Update=function(a){!0!==a.append?(delete a.append,a.action="w"):(delete a.append,a.action="a");b.file.Handler(a)};c.Delete=function(a){a.action="d";b.file.Handler(a)};
c.Exists=function(a){a.action="e";b.file.Handler(a)};c.ClearAll=function(){b.core.deviceIO.ClearAll()}})(b.file||(b.file={}))})(metis||(metis={}));
(function(b){(function(c){(function(a){a.Handle=function(a){var c=a.action,f=a.pending,g=a.contentOrDestinationNodes;a=function(a,c){var d=a.action,e;for(e in c){var g=c[e],f,m=c[g];"Object"==typeof m?("r"==d||"a"==d||"e"==d?"a"==d?(m=b.core.Merge(m,a.contentOrDestinationNodes),chrome.storage.local.set({fileName:m}),m={status:!0}):"e"==d&&(m={status:!0}):m={status:"0.00"},f=!0):f=!1;1==f&&(f=!1,"r"==d||"e"==d?f=!0:"w"!=d&&"a"!=d&&"d"!=d||1!=b.core.metisFlags.Headless||(f=!0),1==f&&a.pending.pop(g),
a.completed[g]=m)}b.devices.cloud.Handle(a)}.bind(this,a);if("r"==c||"a"==c||"e"==c)chrome.storage.local.get(f,a);else if("w"==c){var c={},e;for(e in f)c[f[e]]=g;chrome.storage.local.set(c,a)}else"d"==c&&chrome.storage.local.remove(f,a)};a.ClearAll=function(){chrome.storage.local.clear()}})(c.chromeos||(c.chromeos={}))})(b.devices||(b.devices={}))})(metis||(metis={}));(function(b){b.Init=function(c){return b.core.Init(c)}})(metis||(metis={}));
