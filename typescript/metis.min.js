var metis;(function(b){(function(c){(function(g){function h(j){return localStorage.getItem(j)}g.Read=h;function e(n,k,m){if(m==true){var j=this.Read(n);var l={};if(j!==null){j=JSON.parse(j)}else{j={}}k=b.core.Merge(j,l)}localStorage.setItem(n,JSON.stringify(k))}g.Write=e;function i(j){localStorage.removeItem(j)}g.Delete=i;function f(k){var j;if(this.Read(k)!==null){j="local"}else{j=false}return j}g.Exists=f})(c.cloud||(c.cloud={}));var d=c.cloud})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(a){(function(f){function e(){if(a.file.Exists("internal","ioQueue")!=="local"){a.file.Create("internal","ioQueue",{})}document.addEventListener("online",this.Process(),false);document.addEventListener("offline",this.ToggleStatus(),false)}f.Init=e;function c(){a.core.metisFlags["User Online"]=false}f.ToggleStatus=c;function d(){if(a.core.metisFlags["Battery OK"]==true){var i=a.file.Decode(a.file.Read("internal","ioQueue"));this.userOnline=true;for(var l in i){var h=i[l]["nodeData"];var j=i[l]["action"];var k=i[l]["contentOrDestinationNodes"];if(this.userOnline==true){a.file.Handler(h,l,j,k);i[l]=null}else{break}}a.file.Update("internal","ioQueue",i,false)}}f.Process=d;function g(i,h,j,p){var l=a.file.Decode(a.file.Read("internal","ioQueue"));var r="";if(typeof i=="string"){r=i}else{if(typeof i=="object"){for(var o in i){var q=o;if(i[o]!==null){q=q+"#";var n=i[o];n.forEach(function(t,u,s){q=q+t;if(s.length!==(u+1)){q=q+","}else{q=q+"|"}});r=r+q}else{r=r+o+"|"}}r=r.slice(0,-1)}else{if(typeof i=="number"){r=i.toString()}}}if(typeof h=="string"){h=[h]}for(var k in h){var m=h[k];if(l.hasOwnProperty(m)==false){l[m]={}}if((l[m]["action"]=="w")&&(j=="d")){l[m]=null}else{l[m]["nodeData"]=r;l[m]["action"]=j;if(j==("w"||"a")){l[m]["contentOrDestinationNodes"]=p}else{if(l[m].hasOwnProperty("contentOrDestinationNodes")){l[m]["contentOrDestinationNodes"]=null}}}}a.file.Update("internal","ioQueue",l,false)}f.AddItem=g})(a.queuer||(a.queuer={}));var b=a.queuer})(metis||(metis={}));var metis;(function(a){(function(d){function h(y,m,n,v){var p={};var w=[];if(typeof m=="string"){m=[m]}for(var o in m){var q=m[o];var u;if(n=="r"){u=a.core.deviceIO.Read(q);if(u!==null){u=this.Decode(u)}else{w.push(q)}}else{if(n!=="e"){if(n=="w"){a.core.deviceIO.Write(q,v,false)}else{if(n=="a"){a.core.deviceIO.Write(q,v,true)}else{if(n=="d"){a.core.deviceIO.Delete(q)}}}u=this.Decode('{"status" : "0.00"}')}else{if(a.core.deviceIO.Exists(q)!==null){u="local"}else{if(a.core.metisFlags.Headless==true){u=false}else{if((a.core.metisFlags.Headless!==true)&&(y!=="internal")){w.push(q)}}}}}if(m.length==1){p=u}else{p[q]=u}}if(y!=="internal"){if(a.core.metisFlags.Headless==false){if((a.core.metisFlags["User Online"]==true)&&(a.core.metisFlags["Battery OK"]==true)){if((n=="r"&&w.length>0)||(n!=="r")){var r={};r.nodeData=y;if(n==("r"||"e")){r.files=w}else{r.files=m}r.fileAction=n;if(v!==(undefined||null)){r.contentOrDestinationNodes=v}var x=new XMLHttpRequest;var t="";function s(){if(x.readyState==4){if(x.status==200){t=x.responseText}else{t='{"error" : "HTTP ERROR CODE|'+x.status+'"}'}}}x.onreadystatechange=s;x.open("POST",a.core.metisFlags.Callback,false);x.send(JSON.stringify(r));var l=this.Decode(t);if(w.length==1){p=l}else{p=a.core.Merge(p,l)}if(n=="r"){for(var o in w){var q=w[o];if(w.length==1){a.core.deviceIO.Write(q,JSON.stringify(l))}else{a.core.deviceIO.Write(q,JSON.stringify(l[q]))}}}}}else{if(n!=="r"){w=m}if(w.length>0){a.queuer.AddItem(y,w,n,v)}}}}return JSON.stringify(p)}d.Handler=h;function c(l){return JSON.parse(l)}d.Decode=c;function e(l,m){return this.Handler(l,m,"r")}d.Read=e;function f(l,n,m){return this.Handler(l,n,"w",m)}d.Create=f;function g(l,n,m,o){if(o==(undefined||false)){return this.Handler(l,n,"w",m)}else{return this.Handler(l,n,"a",m)}}d.Update=g;function k(l,m){return this.Handler(l,m,"d")}d.Delete=k;function j(l,m){return this.Handler(l,m,"e")}d.Exists=j;function i(l,m,n){return this.Handler(l,n,"rp",m)}d.Replicator=i})(a.file||(a.file={}));var b=a.file})(metis||(metis={}));var metis;(function(b){(function(c){c.deviceIO;c.metisFlags;function e(f){this.metisFlags={};if(f.Headless==(undefined||false)){f.Headless=false;b.queuer.Init();if(f.Callback==undefined){console.log("You have defined Headless as FALSE but have NOT provided a callback URL. Expect errors.")}}if(f.Device==undefined){f.Device="Cloud"}if(f["User Online"]==undefined){if(f.Device=="Cloud"){f["User Online"]=window.navigator.onLine;b.core.metisFlags["Battery OK"]=true}else{if(navigator.connection.type!==Connection.NONE){f["User Online"]=true}else{f["User Online"]=false}document.addEventListener("batterystatus",function(g){if(g.isPlugged==true||g.level>=15){b.core.metisFlags["Battery OK"]=true}else{b.core.metisFlags["Battery OK"]=false}},false)}}this.deviceIO=b.devices.cloud;this.metisFlags=f}c.Init=e;function d(g,f){for(var h in f){if(typeof f[h]=="object"){if(g[h]!==undefined){g[h]=this.Merge(g[h],f[h])}else{g[h]=f[h]}}else{g[h]=f[h]}}return g}c.Merge=d})(b.core||(b.core={}));var a=b.core})(metis||(metis={}));var metis;(function(b){function e(i){return b.core.Init(i)}b.Init=e;function d(i,j){return b.file.Read(i,j)}b.readJsonFile=d;function a(i,k,j){return b.file.Create(i,k,j)}b.createJsonFile=a;function h(j,k,i){return b.file.Update(j,k,i)}b.updateJsonFile=h;function c(i){return b.file.Decode(i)}b.decodeJsonFile=c;function f(i,j){return b.file.Exists(i,j)}b.fileExists=f;function g(i,k,j){return b.file.Replicator(i,k,j)}b.replicator=g})(metis||(metis={}));