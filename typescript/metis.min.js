var metis;(function(b){(function(c){(function(e){function f(p){var h=b.file.currentIO[p]["pending"]["action"];var m=b.file.currentIO[p]["pending"]["files"];var o=b.file.currentIO[p]["pending"]["contentOrDestinationNodes"];var s=b.file.currentIO[p]["completed"];var q=b.file.currentIO[p]["callback"];var i=b.file.currentIO[p]["callback-data"];if(b.file.currentIO[p]["pending"]["nodeData"]!=="internal"){if(b.core.metisFlags.Headless==false){if((b.core.metisFlags["User Online"]==true)&&(b.core.metisFlags["Battery OK"]==true)){if(m.length>0){var k={};k.nodeData=b.file.currentIO[p]["pending"]["nodeDataDefined"];k.files=m;k.fileAction=h;if(o!==(undefined||null)){k.contentOrDestinationNodes=o}var r=new XMLHttpRequest;function l(){if(r.readyState==4){var w;if(r.status==200){w=b.file.Decode(r.responseText)}else{w={error:"HTTP ERROR CODE|' + xhrManager.status + '"}}for(var v in w){var u;if(m.length==1){v=m[0];u=w}else{u=w[v]}b.file.currentIO[p]["pending"]["files"].pop(v);b.file.currentIO[p]["completed"][v]=u;if(h=="r"){var t={nodeData:"internal",files:v,action:"w",contentOrDestinationNodes:u};b.file.Handler(t)}}if(q!==false){q(b.file.currentIO[p]["completed"],i)}}}r.onreadystatechange=l;r.open("POST",b.core.metisFlags.Callback,true);r.send(JSON.stringify(k))}}else{var g=b.file.currentIO[p]["pending"]["files"];if(b.file.currentIO[p]["pending"]["action"]!=="r"){g.push(Object.keys(s))}if(g.length>0){var n=b.file.RandomIOIdGenerator();var j={pending:{nodeDataDefined:b.file.currentIO[p]["pending"]["nodeDataDefined"],files:g,action:h,contentOrDestinationNodes:o},completed:{}};b.file.currentIO[n]=j;b.queuer.AddItem(n)}if(q!==false){q(s,i)}}}else{if(q!==false){q(s,i)}}}delete b.file.currentIO[p]}e.Handle=f})(c.cloud||(c.cloud={}));var d=c.cloud})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(b){(function(d){(function(e){function f(o){var k=b.file.currentIO[o];var g=k.pending["action"];var l=k.pending["files"];var n=k.pending["contentOrDestinationNodes"];for(var h in l){var i=l[h];var m;var j;if(g==("r"||"a")){m=localStorage.getItem(i);if(m!==null){m=b.file.Decode(m);if(g=="a"){k.contentOrDestinationNodes=b.core.Merge(m,n)}else{j=true}}}if(g==("w"||"a")){localStorage.setItem(i,JSON.stringify(n));j=true;m={status:"0.00"}}else{if(g=="d"){localStorage.removeItem(i);j=true;m={status:"0.00"}}else{if(g=="e"){if(localStorage.getItem(i)!==null){m={status:true}}else{m={status:false}}j=true}}}if(j==true){if((g==("r"||"e"))||((g==("w"||"a"||"d"))&&(b.core.metisFlags.Headless==true))){b.file.currentIO[o]["pending"]["files"].pop(i)}b.file.currentIO[o]["completed"][i]=m}}b.devices.cloud.Handle(o)}e.Handle=f})(d.web||(d.web={}));var c=d.web})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(a){(function(f){function e(){function h(i){if(i.ioQueue==false){a.file.Create({nodeData:"internal",fileName:"ioQueue",contentOrDestinationNodes:{}})}}a.file.Exists({nodeData:"internal",files:"ioQueue",callback:h});document.addEventListener("online",a.queuer.Process,false);document.addEventListener("offline",a.queuer.ToggleStatus,false)}f.Init=e;function c(){a.core.metisFlags["User Online"]=false}f.ToggleStatus=c;function d(){if(a.core.metisFlags["Battery OK"]==true){a.file.Read({nodeData:"internal",files:"ioQueue",callback:function(i){i=i.ioQueue;a.core.metisFlags["User Online"]=true;for(var l in i){var h=i[l]["nodeData"];var j=i[l]["action"];var k=i[l]["contentOrDestinationNodes"];if(a.core.metisFlags["User Online"]==true){a.file.Handler({nodeData:h,files:l,action:j,contentOrDestinationNodes:k});delete i[l]}else{break}}a.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:i})}})}}f.Process=d;function g(h){a.file.Read({nodeData:"internal",files:"ioQueue",callback:function(n,j){n=n.ioQueue;var q=a.file.currentIO[j.relatedIOId];var k=q.pending["nodeData"];var l=q.pending["action"];var i=q.pending["files"];for(var m in i){var o=i[m];if(n.hasOwnProperty(o)==true){delete n[o]}n[o]={};n[o]["nodeData"]=k;n[o]["action"]=l;if(l==("w"||"a")){var p=q.pending["contentOrDestinationNodes"];n[o]["contentOrDestinationNodes"]=p}else{delete n[o]["contentOrDestinationNodes"]}}a.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:n})},"callback-data":{relatedIOId:h}})}f.AddItem=g})(a.queuer||(a.queuer={}));var b=a.queuer})(metis||(metis={}));var metis;(function(b){(function(c){c.deviceIO;c.metisFlags;function e(f){this.metisFlags={};if(f.Headless==(undefined||false)){f.Headless=false;b.queuer.Init();if(f.Callback==undefined){console.log("You have defined Headless as FALSE but have NOT provided a callback URL. Expect errors.")}}if(f.Device==undefined){f.Device="Cloud"}if(f["User Online"]==undefined){if(f.Device=="Cloud"){f["User Online"]=window.navigator.onLine;b.core.metisFlags["Battery OK"]=true}else{if(navigator.connection.type!==Connection.NONE){f["User Online"]=true}else{f["User Online"]=false}document.addEventListener("batterystatus",function(g){if(g.isPlugged==true||g.level>=15){b.core.metisFlags["Battery OK"]=true}else{b.core.metisFlags["Battery OK"]=false}},false)}}if(f.Device.toLowerCase().indexOf("chrome")==-1){this.deviceIO=b.devices.web}else{this.deviceIO=b.devices.chromeos}this.metisFlags=f}c.Init=e;function d(g,f){for(var h in f){if(typeof f[h]=="object"){if(g[h]!==undefined){g[h]=this.Merge(g[h],f[h])}else{g[h]=f[h]}}else{g[h]=f[h]}}return g}c.Merge=d})(b.core||(b.core={}));var a=b.core})(metis||(metis={}));var metis;(function(a){(function(d){d.currentIO={};function g(){var n;var m=true;while(m==true){n=(Math.random()*(99999-10000)+10000).toString();if(a.file.currentIO[n]==undefined){m=false;break}}return n}d.RandomIOIdGenerator=g;function i(s){var p=a.file.RandomIOIdGenerator();var q="";var m=s.nodeData;if(typeof m=="string"){q=m}else{if(typeof m=="object"){for(var t in m){var r=t;if(m[t]!==null){r=r+"#";var o=m[t];o.forEach(function(v,w,u){r=r+v;if(u.length!==(w+1)){r=r+","}else{r=r+"|"}});q=q+r}else{m=m+t+"|"}}m=m.slice(0,-1);q=m}else{if(typeof m=="number"){q=m.toString()}}}if(typeof s.files=="string"){s.files=[s.files]}if(s.contentOrDestinationNodes==undefined){s.contentOrDestinationNodes=false}if(s.callback==undefined){s.callback=false}if(arguments["callback-data"]==undefined){arguments["callback-data"]=false}var n={pending:{nodeData:q,files:s.files,action:s.action,contentOrDestinationNodes:s.contentOrDestinationNodes},completed:{},callback:s.callback};a.file.currentIO[p]=n;a.core.deviceIO.Handle(p)}d.Handler=i;function c(m){return JSON.parse(m)}d.Decode=c;function e(m){m.action="r";a.file.Handler(m)}d.Read=e;function f(m){m.action="w";a.file.Handler(m)}d.Create=f;function h(m){if(m.append==(undefined||false)){delete m.append;m.action="w";a.file.Handler(m)}else{delete m.append;m.action="a";a.file.Handler(m)}}d.Update=h;function l(m){m.action="d";a.file.Handler(m)}d.Delete=l;function k(m){m.action="e";a.file.Handler(m)}d.Exists=k;function j(m){m.action="rp";a.file.Handler(m)}d.Replicator=j})(a.file||(a.file={}));var b=a.file})(metis||(metis={}));var metis;(function(b){(function(c){(function(f){function e(n){var j=b.file.currentIO[n];var g=j.pending["action"];var l=j.pending["files"];var m=j.pending["contentOrDestinationNodes"];var o=function k(){var p=arguments[0];var s=b.file.currentIO[p]["pending"]["action"];if(s==("r"||"a"||"e")){var r=arguments[1];for(i in r){var q;var u=r[i];if(typeof u=="Object"){if(s=="a"){var t=b.file.currentIO[p]["pending"]["contentOrDestinationNodes"];u=b.core.Merge(u,t);chrome.storage.local.set({fileName:u});u={status:true}}else{if(s=="e"){u={status:true}}}q=true}else{q=false}}}else{if(chrome.runtime.lastError==undefined){u={status:"0.00"};q=true}else{u={error:chrome.runtime.lastError};if(s=="w"){q=false}else{q=true}}}if(q==true){if((s==("r"||"e"))||((s==("w"||"a"||"d"))&&(b.core.metisFlags.Headless==true))){b.file.currentIO[p]["pending"]["files"].pop(i)}b.file.currentIO[p]["completed"][i]=u}b.devices.cloud.Handle(p)}.bind(this,n);if(g==("r"||"a"||"e")){chrome.storage.local.get(l,o)}else{if(g=="w"){var h={};for(var i in l){h[i]=m}chrome.storage.local.set(h,o)}else{if(g=="d"){chrome.storage.local.remove(l,o)}}}}f.Handle=e})(c.chromeos||(c.chromeos={}));var d=c.chromeos})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(b){function e(i){return b.core.Init(i)}b.Init=e;function d(j,k){var i={nodeData:j,files:k};return b.file.Read(i)}b.readJsonFile=d;function a(j,l,k){var i={nodeData:j,files:l,contentOrDestinationNodes:k};return b.file.Create(i)}b.createJsonFile=a;function h(k,m,l,i){var j={nodeData:k,files:m,contentOrDestinationNodes:l,append:i};return b.file.Update(j)}b.updateJsonFile=h;function c(i){return b.file.Decode(i)}b.decodeJsonFile=c;function f(j,k){var i={nodeData:j,files:k};return b.file.Exists(i)}b.fileExists=f;function g(j,l,k){var i={nodeData:j,files:k,contentOrDestinationNodes:l};return b.file.Replicator(i)}b.replicator=g})(metis||(metis={}));