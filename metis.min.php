class Metis{
function fileHashing($BB){$A=str_replace(" ","",atlasui_string_clean($BB,1,true));$x=atlasui_hashing($A,100000,substr($A,0,10));return substr($x,1,28);}function navigateToLocalMetisData($N=null){global$e;$w=getcwd();if($e!==null){chdir($e);}chdir("Metis");chdir("data");if($N!==null){if(chdir($N)==false){return 2.01;}}return$w;}function backupQueuer(array$v,array$B,$C){global$I;$t=navigateToLocalMetisData("backup");$L=file_get_contents(fileHashing("backup-queue").".json");$u=md5($L);if(strlen(trim($L))>2){$H=decodeJsonFile($L);}else{$H=array();}$U=array();foreach($v as$F=>$f){if($I[$F]["Backup Data"]!==null){if($I[$F]["Backup Data"]["Enabled"]==true){$U[]=$F;}}else{if(nodeInfo($F,"Node Type")=="group"){if(gettype($f)=="array"){$T=$f;}else{$T=nodeInfo($F,"group-nodes");}foreach($T as$b){if($T[$b]["Backup Data"]!==null){if($T[$b]["Backup Data"]["Enabled"]==true){$U[]=$F."#".$b;}}}}}if(count($U)>0){foreach($U as$K){if(gettype($H[$K])!=="array"){$H[$K]=array();}foreach($B as$A){if($H[$K][$A]!==null){$y=$H[$K][$A];$a=$y["action"];if($a!==$C){if((($a=="w")||($a=="a"))&&($C=="d")){$H[$K][$A]["action"]=$C;}}}else{$H[$K][$A]=array();$H[$K][$A]["action"]=$C;}}}}}$L=json_encode($H);$z=md5($L);if($u!==$z){$A=fileHashing("backup-queue");$R=fopen($A.".json","w+");fwrite($R,$L);fclose($R);touch($A.".json");}chdir($t);}function fileIOArrayMerger(array$DB){$P=array();foreach($DB as$W){$CB=array_keys($W);foreach($CB as$A){if(is_null($P[$A])){$P[$A]=$W[$A];}elseif(is_int($P[$A])){if(is_array($W[$A])){$P[$A]=$W[$A];}}}}return$P;}function fileActionHandler($s,array$B,$C,array$J=null){global$I;if($I!==1.01){$G=array();$_=getcwd();$E=nodeDataParser($s);if(count($B)==1){$Z=false;}else{$Z=true;}foreach($E as$F=>$h){if(nodeInfo($F,"Node Type")=="group"){$i=true;if(gettype($h)=="array"){$Y=$h;}else{$Y=nodeInfo($F,"group-nodes");}}else{$i=false;$Y=array($F);}foreach($Y as$X){if($i==true){$V=$I[$F];}else{$V=$I;}$AB=nodeInfo($X,"Node Type",$V);$N=nodeInfo($X,"Preferential Location",$V);if(($AB=="local")&&($N!=="backup")){$EB=navigateToLocalMetisData($N);if($EB!==2.01){foreach($B as$M){$A=fileHashing($M);$D="";if(($C=="r")||($C=="a")){$D=file_get_contents($A.".json");if($D==false){$D=2.05;}else{$D=decodeJsonFile($D);}}if(($C=="w")||($D!==2.05&&$C=="a")){if($C=="a"){$S=array_replace_recursive($D,$J);}else{$S=$J;}$S=json_encode($S);if($S==false){$D=3.01;}else{$R=fopen($A.".json","w+");fwrite($R,$S);fclose($R);touch($A.".json");$D="0.00";}}else if($C=="e"){$D=array("found"=>file_exists($A.".json"));}else if($C=="d"){if(unlink($A.".json")!==false){$D="0.00";}else{$D=4.01;}}if($Z==true){$G=fileIOArrayMerger(array($G,array($M=>$D)));}else{if(($C=="r")&&($D!==1.05)){unset($B[$M]);}$G=$D;if($C=="r"){break 3;}}}chdir($_);}else{$G=2.01;}}else{$p=nodeInfo($X,"Node Type",$V);$O=array();$O["fileAction"]=$C;$O["nodeData"]=$N;$O["files"]=$B;if(is_null($J)==false){$O["contentOrDestinationNodes"]=$J;}$n=json_encode($O,true);$Q=atlasui_http_request($p."/callback.php","POST",$n);if($Z==true){if(count($B)>1){$k=decodeJsonFile($Q);foreach($k as$A=>$r){if(gettype($r)=="array"){unset($B[$A]);}}$G=fileIOArrayMerger(array($G,$Q));}else{$A=$B[0];if(strlen($Q)!=="3"){unset($B[0]);}$G=fileIOArrayMerger(array($G,array($A=>$Q)));}}else{$G=$Q;}}}}backupQueuer($E,$B,$C);return json_encode($G);}else{return 1.01;}}function decodeJsonFile($m){$d=json_decode($m,true);if($d==(false||NULL||null)){$d=2.06;}return$d;}function createJsonFile($E,array$B,array$J){return fileActionHandler($E,$B,"w",$J);}function readJsonFile($E,array$B){return fileActionHandler($E,$B,"r");}function updateJsonFile($E,array$B,array$J,$o=true){if($o==false){$g="w";}else{$g="a";}return fileActionHandler($E,$B,$g,$J);}function deleteJsonFile($E,array$B){return fileActionHandler($E,$B,"d");}function replicator($E,$q,array$B){global$I;if($I!==1.01){foreach($B as$M){$c=readJsonFile($E,array($M));if(gettype($c)=="string"){$j=decodeJsonFile($c);foreach($q as$l){createJsonFile($l,array($M),$j);}}else{return$c;}}return"0.00";}else{return$I;}}
function getNodeList(){$Y=$_SERVER['DOCUMENT_ROOT'];$O=getcwd();$L=0;$W=null;$C=null;$K=false;$A="";while($L<6){if($C!==null){chdir($C);}$W=getcwd();if(is_dir("Metis")==true){$K=true;break;}else{if($W!==$_SERVER['DOCUMENT_ROOT']){if($C==null){$C="../";}else{$C=$C."../";}}else{$K=false;break;}}chdir($O);$L=$L+1;}if($K==true){chdir($Y);$U=getcwd();$H=str_replace($U,"",$O);if($H!==("/"||"")){$X=substr_count($C,"../");$N=substr_count($H,"/");$M=explode("/",$H);$I=0;if(strpos($H,"/Metis")!==false){$N=$N-1;$M=array_values(array_diff($M,array("Metis")));$X=$N+1;}while($I<$X){$A=$A."/".$M[$I+1];$I=$I+1;}$A=$A."/";}$A=$U.$A;chdir($A);$B=decodeJsonFile(file_get_contents("Metis/nodeList.json"));}else{$B=1.01;}chdir($O);return array($B,$A);}function nodeDataParser($F){$D=array();if(gettype($F)=="string"){if(strpos($F,"|")!==false){$T=explode("|",$F);}else{$T=array($F);}foreach($T as$J){if(strpos($J,"#")!==false){$V=explode("#",$J);$R=$V[0];$E=$V[1];if(strpos($E,",")!==false){$D[$R]=explode(",",$E);}else{$D[$R]=array($E);}}else{$D[$J]=null;}}}else if(gettype($D)=="array"){$D=$F;}else{$D[]=(array)$F;}return$D;}function nodeInfo($G,$S,$P=null){if($P==null){global$B;}else{$B=$P;}if($B[$G]!==null){if($S!=="group-nodes"){$Q=$B[$G][$S];if(isset($Q)){return$Q;}else{return 1.03;}}else{$E=array_keys($B[$G]);$E=array_values(array_diff($E,array("Backup Data","Node Type")));return$E;}}else{die($G." is not defined in nodeList.");}}
function fileExists($R,array$M){return fileActionHandler($R,$M,"e");}function mysqlToMetis($H,$E,array$C){global$K;if(is_object($H)){if($K!==1.01){if($K[$E]!==null){$P=$C["debug"];$L=$C["filePrefix"];$Q=$C["includePrimaryFieldInFile"];$D=$C["table"];$A=$C["primaryField"];if(is_string($D)==true){$O=mysqli_query($H,"SHOW COLUMNS FROM ".$D);$S=mysqli_query($H,"SELECT * FROM ".$D);$G=array();while($T=mysqli_fetch_array($O)){$G[]=$T[0];}if($A==null){$A=$G[0];}while($J=mysqli_fetch_array($S)){$F=array();if($L!==null){$B=$L;}else{$B=$D;}$B=$B."_".$J[$A];if($Q==true){$F[$A]=$J[$A];}foreach($G as$I){if($I!==$A){$F[$I]=$J[$I];}}$N=createJsonFile($E,array($B),$F);if($P==true){print"We attempted to create ".$B." on Node #".$E." and received the following response: ".$N."<br />";}}return"0.00";}else{return 5.01;}}else{return 1.02;}}else{return 1.01;}}else{return 1.06;}}
 }