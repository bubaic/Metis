class Metis{
function fileHashing($y){$A=str_replace(" ","",atlasui_string_clean($y,1,true));$DB=atlasui_hashing($A,100000,substr($A,0,10));return substr($DB,1,28);}function navigateToLocalMetisData($L=null){global$h;$j=getcwd();if($h!==null){chdir($h);}chdir("Metis");chdir("data");if($L!==null){if(chdir($L)==false){return 2.01;}}return$j;}function backupQueuer(array$o,array$B,$C){global$H;$z=navigateToLocalMetisData("backup");$N=file_get_contents(fileHashing("backup-queue").".json");$r=md5($N);if(strlen(trim($N))>2){$I=$this->decodeJsonFile($N);}else{$I=array();}$W=array();foreach($o as$F=>$i){if($H[$F]["Backup Data"]!==null){if($H[$F]["Backup Data"]["Enabled"]==true){$W[]=$F;}}else{if(nodeInfo($F,"Node Type")=="group"){if(gettype($i)=="array"){$X=$i;}else{$X=nodeInfo($F,"group-nodes");}foreach($X as$b){if($X[$b]["Backup Data"]!==null){if($X[$b]["Backup Data"]["Enabled"]==true){$W[]=$F."#".$b;}}}}}if(count($W)>0){foreach($W as$K){if(gettype($I[$K])!=="array"){$I[$K]=array();}foreach($B as$A){if($I[$K][$A]!==null){$u=$I[$K][$A];$a=$u["action"];if($a!==$C){if((($a=="w")||($a=="a"))&&($C=="d")){$I[$K][$A]["action"]=$C;}}}else{$I[$K][$A]=array();$I[$K][$A]["action"]=$C;}}}}}$N=json_encode($I);$BB=md5($N);if($r!==$BB){$A=$this->fileHashing("backup-queue");$P=fopen($A.".json","w+");fwrite($P,$N);fclose($P);touch($A.".json");}chdir($z);}function fileIOArrayMerger(array$AB){$Q=array();foreach($AB as$T){$v=array_keys($T);foreach($v as$A){if(is_null($Q[$A])){$Q[$A]=$T[$A];}elseif(is_int($Q[$A])){if(is_array($T[$A])){$Q[$A]=$T[$A];}}}}return$Q;}function fileActionHandler($x,$B,$C,array$J=null){global$H;if($H!==1.01){$G=array();$CB=getcwd();$E=$this->nodeDataParser($x);if(gettype($B)=="string"){$B=(array)$B;$V=false;}else{if(count($B)==1){$V=false;}else{$V=true;}}foreach($E as$F=>$g){if(nodeInfo($F,"Node Type")=="group"){$f=true;if(gettype($g)=="array"){$Z=$g;}else{$Z=nodeInfo($F,"group-nodes");}}else{$f=false;$Z=array($F);}foreach($Z as$Y){if($f==true){$U=$H[$F];}else{$U=$H;}$w=nodeInfo($Y,"Node Type",$U);$L=nodeInfo($Y,"Preferential Location",$U);if(($w=="local")&&($L!=="backup")){$_=navigateToLocalMetisData($L);if($_!==2.01){foreach($B as$M){$A=$this->fileHashing($M);$D="";if(($C=="r")||($C=="a")){$D=file_get_contents($A.".json");if($D==false){$D=2.05;}else{$D=$this->decodeJsonFile($D);}}if(($C=="w")||($D!==2.05&&$C=="a")){if($C=="a"){$O=array_replace_recursive($D,$J);}else{$O=$J;}$O=json_encode($O);if($O==false){$D=3.01;}else{$P=fopen($A.".json","w+");fwrite($P,$O);fclose($P);touch($A.".json");$D="0.00";}}else if($C=="e"){$D=array("found"=>file_exists($A.".json"));}else if($C=="d"){if(unlink($A.".json")!==false){$D="0.00";}else{$D=4.01;}}if($V==true){$G=fileIOArrayMerger(array($G,array($M=>$D)));}else{if(($C=="r")&&($D!==1.05)){unset($B[$M]);}$G=$D;if($C=="r"){break 3;}}}chdir($CB);}else{$G=2.01;}}else{$EB=nodeInfo($Y,"Node Type",$U);$R=array();$R["fileAction"]=$C;$R["nodeData"]=$L;$R["files"]=$B;if(is_null($J)==false){$R["contentOrDestinationNodes"]=$J;}$t=json_encode($R,true);$S=atlasui_http_request($EB."/callback.php","POST",$t);if($V==true){if(count($B)>1){$l=$this->decodeJsonFile($S);foreach($l as$A=>$n){if(gettype($n)=="array"){unset($B[$A]);}}$G=fileIOArrayMerger(array($G,$S));}else{$A=$B[0];if(strlen($S)!=="3"){unset($B[0]);}$G=fileIOArrayMerger(array($G,array($A=>$S)));}}else{$G=$S;}}}}if($C!=="r"){$FB=backupQueuer($E,$B,$C);}return json_encode($G);}else{return 1.01;}}function decodeJsonFile($k){$d=json_decode($k,true);if($d==(false||NULL||null)){$d=2.06;}return$d;}function createJsonFile($E,$B,array$J){return fileActionHandler($E,$B,"w",$J);}function readJsonFile($E,$B){return fileActionHandler($E,$B,"r");}function updateJsonFile($E,$B,array$J,$m=true){if($m==false){$e="w";}else{$e="a";}return fileActionHandler($E,$B,$e,$J);}function deleteJsonFile($E,$B){return fileActionHandler($E,$B,"d");}function replicator($E,$s,$B){global$H;if($H!==1.01){if(gettype($B)=="string"){$B=(array)$B;}foreach($B as$M){$c=$this->readJsonFile($E,array($M));if(gettype($c)=="string"){$q=$this->decodeJsonFile($c);foreach($s as$p){createJsonFile($p,array($M),$q);}}else{return$c;}}return"0.00";}else{return$H;}}
function metisInit(){$T=$_SERVER['DOCUMENT_ROOT'];$N=getcwd();$I=0;$J=null;$D=null;$G=false;$K="";while($I<6){if($D!==null){chdir($D);}$J=getcwd();if(is_dir("Metis")==true){$G=true;break;}else{if($J!==$_SERVER['DOCUMENT_ROOT']){if($D==null){$D="../";}else{$D=$D."../";}}else{$G=false;break;}}chdir($N);$I=$I+1;}if($G==true){chdir($T);$S=getcwd();$U=str_replace($S,"",$J);$K=str_replace("//","/",$S.$U);chdir($K);$A=$this->decodeJsonFile(file_get_contents("Metis/nodeList.json"));}else{$A=1.01;}chdir($N);return array($A,$K);}function nodeDataParser($E){$B=array();if(gettype($E)=="string"){if(strpos($E,"|")!==false){$P=explode("|",$E);}else{$P=array($E);}foreach($P as$H){if(strpos($H,"#")!==false){$R=explode("#",$H);$Q=$R[0];$C=$R[1];if(strpos($C,",")!==false){$B[$Q]=explode(",",$C);}else{$B[$Q]=array($C);}}else{$B[$H]=null;}}}else if(gettype($B)=="array"){$B=$E;}else{$B[]=(array)$E;}return$B;}function nodeInfo($F,$O,$M=null){if($M==null){global$A;}else{$A=$M;}if($A[$F]!==null){if($O!=="group-nodes"){$L=$A[$F][$O];if(isset($L)){return$L;}else{return 1.03;}}else{$C=array_keys($A[$F]);$C=array_values(array_diff($C,array("Backup Data","Node Type")));return$C;}}else{die($F." is not defined in nodeList.");}}
function fileExists($R,$M){return fileActionHandler($R,$M,"e");}function mysqlToMetis($H,$E,array$C){global$K;if(is_object($H)){if($K!==1.01){if($K[$E]!==null){$P=$C["debug"];$L=$C["filePrefix"];$Q=$C["includePrimaryFieldInFile"];$D=$C["table"];$A=$C["primaryField"];if(is_string($D)==true){$O=mysqli_query($H,"SHOW COLUMNS FROM ".$D);$S=mysqli_query($H,"SELECT * FROM ".$D);$G=array();while($T=mysqli_fetch_array($O)){$G[]=$T[0];}if($A==null){$A=$G[0];}while($J=mysqli_fetch_array($S)){$F=array();if($L!==null){$B=$L;}else{$B=$D;}$B=$B."_".$J[$A];if($Q==true){$F[$A]=$J[$A];}foreach($G as$I){if($I!==$A){$F[$I]=$J[$I];}}$N=$this->createJsonFile($E,array($B),$F);if($P==true){print"We attempted to create ".$B." on Node #".$E." and received the following response: ".$N."<br />";}}return"0.00";}else{return 5.01;}}else{return 1.02;}}else{return 1.01;}}else{return 1.06;}}
 }