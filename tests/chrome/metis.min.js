var metis;(function(b){(function(c){(function(f){function g(m){var h=m.action;var n=m.pending;var o=m.contentOrDestinationNodes;var r=m.completed;var p=m.callback;var i=m["callback-data"];if(m.nodeData!=="internal"){if(b.core.metisFlags.Headless==false){if((b.core.metisFlags["User Online"]==true)&&(b.core.metisFlags["Battery OK"]==true)){if(n.length>0){var k={};k.nodeData=m.nodeData;k.files=n;k.action=h;if(o!==false){k.contentOrDestinationNodes=o}var q=new XMLHttpRequest;function l(){if(q.readyState==4){var s=arguments[0];var v=s["callback-data"];var x;if(q.status==200){x=b.file.Decode(q.responseText)}else{x={error:"HTTP ERROR CODE|"+q.status}}for(var w in x){var u=x[w];s.completed[w]=u;if((h=="r")||(h=="a")){if(u.error==undefined){var t={nodeData:"internal",files:w,action:"w",contentOrDestinationNodes:u};b.file.Handler(t)}}}b.devices.cloud.fireCallback(p,s.completed,v)}}q.onreadystatechange=l.bind(b,m);q.open("POST",b.core.metisFlags.Callback,true);q.send(JSON.stringify(k))}}else{if(m.action!=="r"){n.push(Object.keys(r))}if(n.length>0){var j={nodeData:m.nodeData,pending:n,action:h,contentOrDestinationNodes:o,completed:{}};b.queuer.AddItem(j)}b.devices.cloud.fireCallback(p,r,i)}}else{b.devices.cloud.fireCallback(p,r,i)}}else{b.devices.cloud.fireCallback(p,r,i)}}f.Handle=g;function e(h,i,j){if(h!==false){h(i,j)}}f.fireCallback=e})(c.cloud||(c.cloud={}));var d=c.cloud})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(b){(function(d){(function(e){function g(i){var m=i.action;var h=i.pending;for(var l in h){var o=h[l];var n;var k=false;if((m=="r")||(m=="a")){n=localStorage.getItem(o);if(n!==null){n=b.file.Decode(n);if(m=="r"){k=true}}}if((m=="w")||(m=="a")){if((m=="a")&&(n!==null)){n=b.core.Merge(n,i.contentOrDestinationNodes);localStorage.setItem(o,JSON.stringify(n))}else{n={status:"0.00"};localStorage.setItem(o,JSON.stringify(i.contentOrDestinationNodes))}k=true}else{if(m=="d"){localStorage.removeItem(o);k=true;n={status:"0.00"}}else{if(m=="e"){if(localStorage.getItem(o)!==null){n={status:true}}else{n={status:false}}k=true}}}if(k==true){var j=false;if((m=="r")||(m=="e")){j=true}else{if((m=="w")||(m=="a")||(m=="d")){if(b.core.metisFlags.Headless==true){j=true}}}if(j==true){i.pending.pop(o)}i.completed[o]=n}}b.devices.cloud.Handle(i)}e.Handle=g;function f(){var h=localStorage.length;for(var j=0;j<h;j++){var k=localStorage.key(j);localStorage.removeItem(k)}}e.ClearAll=f})(d.web||(d.web={}));var c=d.web})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(a){(function(f){function e(){a.file.Exists({nodeData:"internal",files:"ioQueue",callback:function(h){if(h.ioQueue["status"]==false){a.file.Create({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:{}})}}});document.addEventListener("online",a.queuer.Process,false);document.addEventListener("offline",a.queuer.ToggleStatus,false)}f.Init=e;function c(){a.core.metisFlags["User Online"]=false}f.ToggleStatus=c;function d(){if(a.core.metisFlags["Battery OK"]==true){a.file.Read({nodeData:"internal",files:"ioQueue",callback:function(i){i=i.ioQueue;a.core.metisFlags["User Online"]=true;for(var l in i){var h=i[l]["nodeData"];var j=i[l]["action"];var k=i[l]["contentOrDestinationNodes"];if(a.core.metisFlags["User Online"]==true){a.file.Handler({nodeData:h,files:l,action:j,contentOrDestinationNodes:k});delete i[l]}else{break}}a.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:i})}})}}f.Process=d;function g(h){a.file.Read({nodeData:"internal",files:"ioQueue",callback:function(l,j){l=l.ioQueue;var i=j.uniqueIOObject;var k=i.pending["nodeData"];var n=i.pending["action"];var p=i.pending["files"];for(var m in p){var o=p[m];if(l.hasOwnProperty(o)==true){delete l[o]}l[o]={};l[o]["nodeData"]=k;l[o]["action"]=n;if(n==("w"||"a")){l[o]["contentOrDestinationNodes"]=i.pending["contentOrDestinationNodes"]}}a.file.Update({nodeData:"internal",files:"ioQueue",contentOrDestinationNodes:l})},"callback-data":{uniqueIOObject:h}})}f.AddItem=g})(a.queuer||(a.queuer={}));var b=a.queuer})(metis||(metis={}));var metis;(function(b){(function(c){c.deviceIO;c.metisFlags;function e(f){this.metisFlags={};if(f.Headless!==true){if(f.Callback==undefined){f.Headless=true}else{if(f.Callback.indexOf("/callback.php")==-1){if(f.Callback.substr(f.Callback.length-1)!=="/"){f.Callback+="/"}f.Callback+="callback.php"}}}if(f.Device==undefined){f.Device="Cloud"}if(f["User Online"]==undefined){if(f.Device!=="Cordova"){f["User Online"]=window.navigator.onLine}else{f["User Online"]=true;if(navigator.connection.type==Connection.NONE){f["User Online"]=false}}}f["Battery OK"]=true;if(f.Device=="Cordova"){document.addEventListener("batterystatus",function(g){b.core.metisFlags["Battery OK"]=true;if(g.isPlugged==false||g.level<15){b.core.metisFlags["Battery OK"]=false}},false)}if(f.Device.toLowerCase().indexOf("chrome")==-1){this.deviceIO=b.devices.web}else{this.deviceIO=b.devices.chromeos}this.metisFlags=f;if(this.metisFlags.Headless==false){b.queuer.Init()}}c.Init=e;function d(g,f){for(var h in f){if(typeof f[h]=="object"){if(g[h]!==undefined){g[h]=this.Merge(g[h],f[h])}else{g[h]=f[h]}}else{g[h]=f[h]}}return g}c.Merge=d})(b.core||(b.core={}));var a=b.core})(metis||(metis={}));var metis;(function(a){(function(e){function i(q){var o="";var l=q.nodeData;if(typeof l=="string"){o=l}else{if(typeof l=="object"){for(var r in l){var p=r;if(l[r]!==null){p=p+"#";var n=l[r];n.forEach(function(t,u,s){p=p+t;if(s.length!==(u+1)){p=p+","}else{p=p+"|"}});o=o+p}else{l=l+r+"|"}}l=l.slice(0,-1);o=l}else{if(typeof l=="number"){o=l.toString()}}}if(typeof q.files=="string"){q.files=[q.files]}if(q.contentOrDestinationNodes==undefined){q.contentOrDestinationNodes=false}if(q.callback==undefined){q.callback=false}if(q["callback-data"]==undefined){q["callback-data"]=false}var m={nodeData:o,pending:q.files,action:q.action,contentOrDestinationNodes:q.contentOrDestinationNodes,completed:{},callback:q.callback,"callback-data":q["callback-data"]};a.core.deviceIO.Handle(m)}e.Handler=i;function c(l){return JSON.parse(l)}e.Decode=c;function f(l){l.action="r";a.file.Handler(l)}e.Read=f;function g(l){l.action="w";a.file.Handler(l)}e.Create=g;function h(l){if(l.append!==true){delete l.append;l.action="w";a.file.Handler(l)}else{delete l.append;l.action="a";a.file.Handler(l)}}e.Update=h;function k(l){l.action="d";a.file.Handler(l)}e.Delete=k;function j(l){l.action="e";a.file.Handler(l)}e.Exists=j;function d(){a.core.deviceIO.ClearAll()}e.ClearAll=d})(a.file||(a.file={}));var b=a.file})(metis||(metis={}));var metis;(function(b){(function(c){(function(g){function f(i){var m=i.action;var h=i.pending;var n=i.contentOrDestinationNodes;var k=function(){var t=arguments[0];var p=t.action;var x=arguments[1];for(var q in x){var r=x[q];var s;var u=x[r];if(typeof u=="Object"){if((p=="r")||(p=="a")||(p=="e")){if(p=="a"){var v=t.contentOrDestinationNodes;u=b.core.Merge(u,v);chrome.storage.local.set({fileName:u});u={status:true}}else{if(p=="e"){u={status:true}}}}else{u={status:"0.00"}}s=true}else{s=false}if(s==true){var w=false;if((p=="r")||(p=="e")){w=true}else{if((p=="w")||(p=="a")||(p=="d")){if(b.core.metisFlags.Headless==true){w=true}}}if(w==true){t.pending.pop(r)}t.completed[r]=u}}b.devices.cloud.Handle(t)}.bind(this,i);if((m=="r")||(m=="a")||(m=="e")){chrome.storage.local.get(h,k)}else{if(m=="w"){var j={};for(var l in h){var o=h[l];j[o]=n}chrome.storage.local.set(j,k)}else{if(m=="d"){chrome.storage.local.remove(h,k)}}}}g.Handle=f;function e(){chrome.storage.local.clear()}g.ClearAll=e})(c.chromeos||(c.chromeos={}));var d=c.chromeos})(b.devices||(b.devices={}));var a=b.devices})(metis||(metis={}));var metis;(function(a){function b(c){return a.core.Init(c)}a.Init=b})(metis||(metis={}));