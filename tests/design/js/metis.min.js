var metis;
(function(b){(function(d){(function(a){a.Handle=function(c){if("internal"===c.NodeData||b.Headless||0===c.PendingFiles.length)b.devices.cloud.fireCallback(c.Callback,c.CompletedFiles,c.CallbackData);else if(b.Online){var a={NodeData:c.NodeData,Action:c.Action,Files:c.Files};"object"==typeof c.ContentOrDestinationNodes&&(a.ContentOrDestinationNodes=c.ContentOrDestinationNodes);var f=new XMLHttpRequest;f.onreadystatechange=function(c){if(4==f.readyState){var a;a=200==f.status?b.file.Decode(f.responseText):{error:"HTTP ERROR CODE|"+
f.status};for(var m in a){var d=a[m];c.CompletedFiles[m]=d;"r"!=c.Action&&"a"!=c.Action||"undefined"!=typeof d.error||b.file.IO({NodeData:"internal",Files:m,Action:"w",ContentOrDestinationNodes:d})}b.devices.cloud.fireCallback(c.Callback,c.CompletedFiles,c.CallbackData)}}.bind(b,c);f.open("POST",b.Callback,!0);f.send(JSON.stringify(a))}else"r"!==c.Action&&(a=Object.keys(c.CompletedFiles),c.PendingFiles.push(a)),b.scheduler.AddItem({NodeData:c.NodeData,Action:c.Action,PendingFiles:c.PendingFiles,CompletedFiles:{},
ContentOrDestinationNodes:c.ContentOrDestinationNodes}),b.devices.cloud.fireCallback(c.Callback,c.CompletedFiles,c.CallbackData)};a.fireCallback=function(c,b,a){!1!==c&&c(b,a)}})(d.cloud||(d.cloud={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(d){(function(a){a.Handle=function(c){for(var a=c.Action,d=0,e=c.PendingFiles;d<e.length;d++){var g=e[d],h={success:!0};if("r"==a||"a"==a)h=localStorage.getItem(g),h=null!==h?b.file.Decode(h):{error:"file_doesnt_exist"};"w"==a||"a"==a?("a"==a&&"string"!==typeof h.error&&(c.ContentOrDestinationNodes=b.file.Merge(h,c.ContentOrDestinationNodes)),localStorage.setItem(g,JSON.stringify(c.ContentOrDestinationNodes))):"d"==a?localStorage.removeItem(g):"e"==a&&(h={exists:!0},null==localStorage.getItem(g)&&
(h={exists:!1}));var l=!1;"r"==a&&"undefined"==typeof h.error||"e"==a?l=!0:("w"==a||"a"==a||"d"==a)&&b.Headless&&(l=!0);l&&(c.PendingFiles=b.file.ArrayRemove(c.PendingFiles,g));c.CompletedFiles[g]=h}b.devices.cloud.Handle(c)};a.ClearAll=function(){localStorage.clear()}})(d.web||(d.web={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){(function(d){d.Init=function(){b.file.IO({NodeData:"internal",Action:"e",Files:"ioQueue",Callback:function(a){0==a.ioQueue.status&&b.file.IO({NodeData:"internal",Action:"w",Files:"ioQueue",ContentOrDestinationNodes:{}})}});document.addEventListener("online",b.scheduler.Process,!1);document.addEventListener("offline",b.scheduler.ToggleStatus,!1)};d.ToggleStatus=function(){b.Online=!1};d.Process=function(){b.file.IO({NodeData:"internal",Action:"r",Files:"ioQueue",Callback:function(a){a=
a.ioQueue;b.Online=!0;for(var c in a){var d=a[c].NodeData,f=a[c].Action,e=a[c].ContentOrDestinationNodes;if(b.Online)b.file.IO({NodeData:d,Action:f,Files:c,ContentOrDestinationNodes:e}),delete a[c];else break}b.file.IO({NodeData:"internal",Action:"u",Files:"ioQueue",ContentOrDestinationNodes:a})}})};d.AddItem=function(a){b.file.IO({NodeData:"internal",Action:"r",Files:"ioQueue",Callback:function(c,a){c=c.ioQueue;for(var d=a.uniqueIOObject,e=0,g=d.Files;e<g.length;e++){var h=g[e];1==c.hasOwnProperty(h)&&
delete c[h];var l={NodeData:d.NodeData,Action:d.Action,Files:d.Files};"w"==d.Action&&(l.ContentOrDestinationNodes=d.ContentOrDestinationNodes);c[h]=l}b.file.IO({NodeData:"internal",Action:"u",Files:"ioQueue",ContentOrDestinationNodes:c})},CallbackData:{uniqueIOObject:a}})}})(b.scheduler||(b.scheduler={}))})(metis||(metis={}));
(function(b){(function(d){d.IO=function(a){"number"===typeof a.NodeData&&(a.NodeData=a.NodeData.toString());"string"==typeof a.Files&&(a.Files=Array(a.Files));b.DeviceIO.Handle({NodeData:a.NodeData,Action:a.Action,ContentOrDestinationNodes:a.ContentOrDestinationNodes,PendingFiles:a.Files,CompletedFiles:{},Callback:a.Callback,CallbackData:a.CallbackData})};d.Decode=function(a){return JSON.parse(a)};d.ClearAll=function(){b.DeviceIO.ClearAll()};d.ArrayRemove=function(a,c){var b=a.indexOf(c);return-1!==
b?Array.prototype.concat(a.slice(0,b),a.slice(b+1)):a};d.Merge=function(a,c){for(var b in c)a[b]="object"==typeof c[b]?void 0!==a[b]?this.Merge(a[b],c[b]):c[b]:c[b];return a}})(b.file||(b.file={}))})(metis||(metis={}));
(function(b){(function(d){(function(a){a.Handle=function(a){var d=a.Action,f=a.PendingFiles,e=a.ContentOrDestinationNodes;a=function(a,c){var d=a.Action,f;for(f in c){var g=c[f],e,k=c[g];"Object"==typeof k?("r"==d||"a"==d||"e"==d?"a"==d?(k=b.file.Merge(k,a.ContentOrDestinationNodes),chrome.storage.local.set({fileName:k}),k={status:!0}):"e"==d&&(k={status:!0}):k={status:"0.00"},e=!0):e=!1;1==e&&(e=!1,"r"==d||"e"==d?e=!0:("w"==d||"a"==d||"d"==d)&&b.Headless&&(e=!0),1==e&&(a.PendingFiles=b.file.ArrayRemove(a.PendingFiles,
g)),a.CompletedFiles[g]=k)}b.devices.cloud.Handle(a)}.bind(this,a);if("r"==d||"a"==d||"e"==d)chrome.storage.local.get(f,a);else if("w"==d){var d={},g;for(g in f)d[f[g]]=e;chrome.storage.local.set(d,a)}else"d"==d&&chrome.storage.local.remove(f,a)};a.ClearAll=function(){chrome.storage.local.clear()}})(d.chromeos||(d.chromeos={}))})(b.devices||(b.devices={}))})(metis||(metis={}));
(function(b){b.Init=function(d){b.Device="Web";"string"==typeof d.Device&&(b.Device=d.Device);"Cordova"!==d.Device?b.Online=window.navigator.onLine:(b.Online=!0,navigator.connection.type==Connection.NONE&&(b.Online=!1));-1==d.Device.toLowerCase().indexOf("chrome")?b.DeviceIO=b.devices.web:b.DeviceIO=b.devices.chromeos;b.Headless=!0;"string"==typeof d.Callback&&(b.Headless=!1,b.scheduler.Init())}})(metis||(metis={}));
